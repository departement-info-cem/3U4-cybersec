---
id: tp3
title: TP3 - Sécuriser une application
sidebar_label: TP3 - Sécuriser une application
draft: false
hide_table_of_contents: false
---

# Travail 3 : sécuriser une application

Nous te fournissons une application qui implante le hachage de mot de passe et l'encryption.

Toutefois, nous allons voir que c'est fait plus ou moins bien. Ton but va être de corriger:
- la technique d'encryption 
- le hachage qui a été choisi 

Finalement, nous allons voir que l'application est exposée aux injections SQL. Ici aussi tu devras corriger.

## Format de remise:

Tu vois avoir un lien GitHub ClassRoom pour remettre ton travail. Tu devras remettre:
1. un fichier **rapport.md** de rapport où tu expliqueras les différentes attaques et les solutions que tu as implantées
2. une version modifiée et corrigée de l'application qui corrige les failles identifiées

IMPORTANT : SI TU NE REMETS PAS LE PROJET consoleApp MODIFIÉ, TU AURAS 0 SUR LES CORRECTIFS.

## Récupération de l'exécutable et test

L'application en C# est fournie. Tu trouveras l'exécutable :
- https://github.com/departement-info-cem/3U4-TP3/releases/latest
- télécharge le consoleApp.exe sur ta machine
- tu peux ensuite l'exécuter

Tu devras mener les attaques uniquement avec le .exe et en imaginant que tu n'as pas accès au code source.

L'application requiert un login et un password pour s’authentifier puis permet de 
- rentrer ses revenus de l’année
- produire un calcul des impôts à payer pour chaque année

## La fuite de la base de données

Normalement, l'application utilise un serveur de base de données sécurisé pour stocker les informations.

Cependant, l'application se rabat sur une BD locale si le serveur n'est pas disponible.

Cela va te permettre d'accéder à la base de données et d'essayer d'accéder au maximum d'informations possible.

### Chercher où est la BD

En utilisant des techniques vues en cours, il faut que tu détermines où le .exe stocke la BD locale.

### Lire la BD avec une application externe

Tu commenceras par tenter le localiser la base de données fichier et trouver une approche pour la lire.


## Attaque 2: BD fuitée et encryption

Actuellement le NAS est «sécurisé» par une méthode d'encryption.

Tu dois chercher une méthode pour décrypter les NAS des comptes des premiers ministres. 

- Ta méthode NE DOIT PAS reposer sur la connaissance du code source. 
- Pour ton attaque, 
  - Tu peux te baser uniquement sur la base de données fuitée 


En correctif, tu devras ensuite implanter un algo d'encryption classique de ton choix dans l'application et montrer que ta technique
précédente ne fonctionne plus (AES par exemple).

## Attaque 3 Injection SQL

L'application a au moins un point de vulnérabilité à une injection SQL. 

Tu devras faire la démonstration d'une attaque par injection SQL. Si tu démontres une attaque qui exécute
n'importe quelle commande SQL, tu gagnes un point. 

Si tu arrives à changer le mot de passe de Justin Trudeau, tu gagnes un point en plus.

<!-- NOUVELLE SECTION: RÈGLES D'ENGAGEMENT -->

## Règles d'engagement (ce qui est permis / interdit)

Avant de commencer les attaques, lis et respecte ces règles. Elles précisent exactement les ressources
qui te sont fournies et les actions autorisées pour chaque type d'attaque. Tout manquement entraîne une
sanction (0 point) pour la partie concernée.

| Attaque | Ressources fournies | Accès permis pendant l'attaque | Accès permis après l'attaque | Remarques / restriction |
| -- | -- | -- | -- | -- |
| Hachage (Attaque 1) | Une base de données *fuitée* contenant uniquement les entrées des "premiers ministres" (users/hachages). | Analyse hors-ligne de la BD fournie. Tu peux utiliser des outils de craquage sur ta machine. **Tu n'as PAS accès au .exe ni à l'application en local** sauf si explicitement indiqué par l'énoncé. | Tu **ne peux pas** consulter la base de données fournie après avoir exécuté ton attaque (les artefacts fournis doivent rester tels quels). Les preuves doivent venir de tes étapes (captures d'écran, logs, sorties d'outils). | L'objectif est d'apprendre à craquer des hachages à partir d'une fuite — pas d'utiliser le binaire pour obtenir les données. |
| Encryption (Attaque 2) | La même BD fuitée (métadonnées / clés faibles, selon scénario). | Analyse hors-ligne de la BD fournie. Tu peux tenter des attaques de récupération sur les données d'encryption en te basant uniquement sur la fuite. | Pas d'accès supplémentaire à la BD après l'attaque. | Tu dois **montrer** l'attaque depuis la BD fuitée et prouver la méthode. |
| Injection SQL (Attaque 3) | L'exécutable `consoleApp.exe` (le binaire). **Tu n'as pas accès à la BD côté serveur** ni aux fichiers de la BD. | Interaction avec le `.exe` (inputs, profils, etc.) pour déclencher et démontrer l'injection SQL. | Tu ne dois pas accéder directement au fichier DB du serveur pour préparer l'attaque — la vulnérabilité doit être exploitée via l'interface fournie. | Si tu as accès à la BD locale pendant la session, préviens l'enseignant — l'attaque doit rester pertinente (injecter via l'interface). |

Remarques générales :
- Ne lance JAMAIS de commandes destructrices réelles sur la machine hôte (par ex. `rm -rf /`). Les démonstrations doivent être contrôlées et reproductibles.
- En cas d'ambiguïté sur ce qui est fourni dans un TP (par ex. s'il existe une VM partagée ou un profil limité), suis les instructions spécifiques du responsable du TP.

### Preuve requise pour le point supplémentaire "changer le mot de passe de Justin Trudeau"

Pour obtenir le point supplémentaire, tu dois fournir dans `rapport.md` une preuve convaincante que tu t'es connecté au compte de Justin (ou que tu as modifié son mot de passe depuis l'application). Accepté :
- Captures d'écran horodatées montrant une session ouverte sous l'identité de Justin (avec éléments d'interface identifiables),
- OU un court enregistrement vidéo (formats courants) montrant la séquence complète (login / modification),
- OU un extrait de log / preuve textuelle exportée qui montre l'action avec horodatage (par ex. trace SQL générée depuis l'interface démontrant l'UPDATE),
- ET un commentaire détaillé dans `rapport.md` expliquant chaque étape et les commandes/outils utilisés.

Non accepté : l'accès au fichier DB brut **après** l'attaque comme seule preuve (c'est-à-dire : ouvrir la BD et modifier manuellement le mot de passe sans passer par l'attaque/exécutable).

### Application corrigée et fonctionnelle

- Tu dois remettre le projet `consoleApp` modifié (code source) pour obtenir les points de correctifs. **Pas de code remis = 0** pour la partie correctif.
- Si tu remets le code mais que l'application ne fonctionne pas (ne démarre pas ou ne remplit plus les fonctions de base), **tu obtiens 0** pour les correctifs — l'application doit continuer à fonctionner.

Pour qu'un correctif soit validé, l'application corrigée doit remplir la séquence de vérification suivante (exemples de test que nous utiliserons) :
1. créer un compte
2. ajouter une année de revenu
3. arrêter l'application
4. redémarrer l'application
5. se connecter avec ce compte
6. vérifier que les revenus sont bien présents

Pas d'application corrigée = 0 ; Application remise mais non fonctionnelle = 0.

## Vérification post correctif

Tu dois t'assurer que ton application fonctionne toujours. Tu peux par exemple vérifier la séquence suivante:
1. te créer un compte
2. t'ajouter une année de revenu
3. arrêter l'application
4. redémarrer l'application
5. te connecter avec ton compte
6. regarder tes revenus
7. vérifier ton profil 

Pour qu'un correctif soit valide, il faut que l'application fonctionne toujours après le correctif.

## Barème

### Hachage

Retrouve les mots de passe de plusieurs utilisateurs:
// ici un tableau indiquant "Point de départ, Permis, Interdit"
| Point de départ | Permis | Interdit |
| -- | -- | -- |
| BD *fuitée* après avoir charger les "premiers ministres". | Accès la BD fuitée (fichier) Outils craquage**Tu n'as PAS accès au .exe ni à l'application en local** sauf si explicitement indiqué par l'énoncé. | Tu **ne peux pas** consulter la base de données fournie après avoir exécuté ton attaque (les artefacts fournis doivent rester tels quels). Les preuves doivent venir de tes étapes (captures d'écran, logs, sorties d'outils). |

- Ta méthode NE DOIT PAS reposer sur la connaissance du code source.
- Pour ton attaque,
  - Tu peux te baser uniquement sur la base de données fuitée

Tu dois ensuite implanter le hachage avec bcrypt dans l'application et montrer que ta technique précédente ne fonctionne plus.

Les modifications devront être apportées:
- à la création d'un compte
- à la connexion pour vérifier le mot de passe

**2 points** pour l'attaque sur les mots de passe dans le rapport avec toutes les étapes et copies d'écran

**4 points** pour chaque correctif implanté via 
- une modification au code source
- une démonstration que l'attaque ne fonctionne plus dans le rapport avec toutes les étapes et copies d'écran

### Encryption

**2 points** pour l'attaque sur l'encryption dans le rapport avec toutes les étapes et copies d'écran

**4 points** pour le correctif de l'encryption 
- une modification au code source
- une démonstration que l'attaque ne fonctionne plus dans le rapport avec toutes les étapes et copies d'écran

### Injection SQL

**1 point** pour l'attaque par injection SQL de base dans le rapport avec toutes les étapes et copies d'écran

**1 point** pour l'attaque qui change le mot de passe de Justin Trudeau dans le rapport avec toutes les étapes et copies d'écran

**4 points** pour le correctif de l'injection SQL 
- une modification au code source
- une démonstration que l'attaque ne fonctionne plus dans le rapport avec toutes les étapes et copies d'écran

### Qualité du français (2 points)
- Le français est correct (utiliser le correcteur de Word avec Antidote au minimum) 

## Annexe :  Modèle de rapport

```markdown
# Rapport TP3 de Cybersec NOM PRENOM

## Attaque 1: BD fuitée et mot de passe

1. Etape 1 + copie d'écran
2. Etape 2 + copie d'écran
3. etc.

### Correctif implanté

Description du correctif.

Preuve que l'attaque ne fonctionne plus avec étapes + copie d'écran


## Attaque 2: BD fuitée et encryption

1. Etape 1 + copie d'écran
2. Etape 2 + copie d'écran
3. etc.

### Correctif implanté

Court descriptif du correctif et lien vers le(s) commit(s).

Preuve que l'attaque ne fonctionne plus avec étapes + copie d'écran

## Attaque 3 Injection SQL

1. Etape 1 + copie d'écran
2. Etape 2 + copie d'écran
3. etc.

### Correctif implanté

Description du correctif.

Preuve que l'attaque ne fonctionne plus avec étapes + copie d'écran

```
