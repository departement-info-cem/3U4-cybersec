---
id: r12.2
title: Rencontre 12.2 - Chiffrement sym√©trique
sidebar_label: 12.2 - Chiffrement sym√©trique
draft: false
hide_table_of_contents: false
---

## Ne pas coder de la crypto soi-m√™me

Vous n'avez sans doute pas le temps ni le niveau pour coder correctement de la crypto sym√©trique.

Le probl√®me peut √™tre l'algo qui est parfois na√Øf. Ou alors la mise en oeuvre qui plante.

## Implanter un algo classique via une librairie

Implanter le code C# pour faire la crypto sym√©trique est assez simple, on peut:
- chercher un peu dans la doc officielle : lien
- chercher sur Google et sauter sur le premier StackOverflow qui a de l'allure
- demander √† ChatGPT ¬´ comment chiffrer avec BlowFish en .NET ¬ª
- demander √† Github Copilot direct dans mon VisualStudio

Il nous reste √† choisir une cl√© de chiffrement pour la plupart des algorithmes:
- il faut que la cl√© soit difficile √† deviner (un pirate pourrait essayer des cl√©s comme il essaie des mots de passe)
- il faut s'assurer qu'on stocke la cl√© dans un endroit peu accessible

## D√©compiler le .exe et trouver la cl√©


> Les solutions de cybersec, Jean-Louis et fils propose une solution de cybers√©curit√©
> ultra sophistiqu√©e de cybers√©curit√© qui se pr√©sente en 2 applications ultra s√©cures
> 
> 1. Notre application utilisateur permet de chiffrer avec une cl√© de 2048 bits (√ßa fait beaucoup) vos mots de passe afin de les stocker de fa√ßon s√©curitaire. M√™me si un pirate acc√®de √† votre ordi il ne pourra pas d√©coder les mots de passe stock√©s. Nous utilisons un algo √† la pointe du progr√®s BlowFish par l'immense star de la crypto: Bruce Schneier
> 
> 2. Notre application gard√©e dans un lieu hyper s√©curitaire nous permet si vous oubliez un mot de passe de le retrouver en nous contactant par courriel.


Nous avons achet√© la super appli et nous avons chiffr√© quelques mots de passe pour s'en souvenir.

L'appli se trouve dans le dossier **sym** JeanLouisEtFils du repo. Vous pouvez t√©l√©charger les fichiers ex√©cutables dans la section [**Releases**](https://github.com/departement-info-cem/3U4-cybersec/releases/tag/JeanLouisEtFils).

- Essayez avec la commande **strings** pour trouver une cha√Æne dans un ex√©cutable
- Essayez dotPeek pour d√©compiler l'appli
- La cl√© doit se trouver dans le code quelque part, explorez l'application pour trouver o√π se trouve la cl√©
de chiffrement. La bonne nouvelle c'est que comme BlowFish est un algo sym√©trique, c'est aussi la cl√©
de d√©chiffrement

---

## üö© CTF-cle-exe (1 point)

**Objectif**: Extraire la cl√© de chiffrement et les param√®tres de l'algorithme depuis l'ex√©cutable JeanLouisEtFils.

**Votre mission**:
1. T√©l√©chargez l'application [JeanLouisEtFils.exe](https://github.com/departement-info-cem/3U4-cybersec/releases/tag/JeanLouisEtFils)
2. Utilisez un d√©compilateur .NET (dotPeek, ILSpy) pour analyser le code
3. Trouvez **tous les param√®tres** n√©cessaires au d√©chiffrement:
   - L'algorithme utilis√©
   - La cl√© de chiffrement
   - Le vecteur d'initialisation (IV)
   - Le mode de chiffrement

:::info O√π chercher?
Dans une application .NET, les classes de cryptographie contiennent g√©n√©ralement les cl√©s et param√®tres. Cherchez des fichiers comme `*Crypto.cs` ou des classes qui font du chiffrement/d√©chiffrement.
:::

**R√©compense**: 1 point au tableau des scores si vous trouvez la cl√© et l'algorithme.

**√Ä noter dans votre rapport**:
- Nom de l'algorithme
- Cl√© en clair
- Vecteur d'initialisation (IV)
- Mode de chiffrement (CBC, CTR, ECB...)

---

## üö© CTF-decrypt (5 points)

**Objectif**: Utiliser les informations trouv√©es dans CTF-cle-exe pour d√©chiffrer des donn√©es r√©elles.

**Pr√©requis**: Avoir compl√©t√© CTF-cle-exe et trouv√© tous les param√®tres.

**Votre mission**:
1. Lancez l'application JeanLouisEtFils et cr√©ez quelques mots de passe
2. Localisez le fichier `encrypted-passwords.txt` dans votre profil utilisateur
3. Utilisez un outil de d√©chiffrement en ligne avec les param√®tres trouv√©s pour d√©crypter les mots de passe

**Outil recommand√©**: https://www.toolhelper.cn/en/SymmetricEncryption/Blowfish

**Param√®tres √† configurer**:
- Algorithm: L'algorithme trouv√© dans le code
- Key: La cl√© trouv√©e dans le code
- IV: Le vecteur d'initialisation trouv√©
- Mode: Le mode de chiffrement (CTR, CBC, etc.)
- Padding: Le type de padding utilis√©
- Input format: Base64 (les donn√©es sont encod√©es en Base64)

:::warning Attention aux formats
- La cl√© peut √™tre en texte ou en hexad√©cimal
- L'IV est souvent en bytes, il faudra peut-√™tre le convertir en hex
- Les donn√©es chiffr√©es sont en Base64
:::

**R√©compense**: 5 points au tableau des scores si vous arrivez √† d√©chiffrer les mots de passe.

**√Ä inclure dans votre rapport**:
- Screenshot de l'outil avec les param√®tres configur√©s
- Le contenu d√©chiffr√© du fichier
- Explication de la m√©thode utilis√©e

---

## D√©crypter les donn√©es

C'est la m√™me cl√© pour chiffrer et d√©chiffrer. Donc si on conna√Æt la cl√© qui permet de chiffrer, on a tout ce qu'il faut pour d√©chiffrer.

On peut alors essayer de programmer un outil servant √† d√©crypter les donn√©es avec le m√™me algorithme, la m√™me cl√© et les m√™mes param√®tres.
- programmer une application qui Decrypt avec BlowFish et la cl√© qu'on a trouv√©e
- passer √† travers le fichier ligne par ligne et d√©crypter les mots de passe

:::tip
Au lieu de programmer un d√©crypteur vous-m√™mes, vous pouvez utiliser un outil d√©j√† fait. Il suffit de ressortir tous les param√®tres. Dans le cas de Blowfish, on a:
- La cl√© sym√©trique
- Le vecteur d'initialisation (iv)
- Le mode de chiffrement (cipher)
- La m√©thode de remplissage (padding)

Voici un site qui permet de param√©trer l'algorithme: https://www.toolhelper.cn/en/SymmetricEncryption/Blowfish
:::


Pour valider tu peux utiliser l'application corpoDecryptor dans le dossier **sym**.

## Chiffrement asym√©trique

Utiliser un algo asym√©trique avec une cl√© publique de chiffrement et une priv√©e pour le d√©chiffrement:
- l'application peut chiffrer les mots de passe avec la cl√© publique >> voir JeanLouisEtFils dans le dossier **asym**
- le d√©chiffrement n√©cessite une cl√© priv√©e >> voir corpoDecryptor dans le dossier **asym**
- la cl√© priv√©e est plus complexe et en g√©n√©ral reli√©e par un probl√®me de calcul tr√®s difficile 
- on utilise ici l'algorithme RSA

Exemple de lien entre cl√© priv√©e et publique:
- on tire 2 nombres premiers tr√®s grands x et y
- la cl√© publique est **""+x*y**
- la cl√© priv√©e est **x +":"+y**
- il est tr√®s difficile de trouver x et y √† partir de x*y mais tr√®s facile de v√©rifier que x*y est bien √©gal √† la cl√© publique

## Quelles solutions pour cacher la cl√©

1. Principe #1, la cl√© ne doit pas √™tre accessible aux utilisateurs. Il faut donc que la partie de la plateforme
qui chiffre se trouve dans les infrastructures de l'entreprise, pas chez les utilisateurs
2. Principe #2, moins il y a de gens qui ont la cl√©, moins il y a de chances de fuites.
3. On peut donc imaginer que seul le responsable du syst√®me en prod a acc√®s √† la cl√© de prod. Les d√©v peuvent 
avoir acc√®s √† une cl√© diff√©rente sur leur environnement de d√©veloppement.

### Le cas classique du client-serveur sur l'aspect cryptographie 

1. L'application cliente envoie les donn√©es au serveur, la s√©curit√© des donn√©es repose sur HTTPS (crypto asym√©trique).
2. Le serveur chiffre (sym√©trique) les donn√©es avant de les stocker en BD, la s√©curit√© repose sur le secret de la cl√©.


