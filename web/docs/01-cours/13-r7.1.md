---
id: r7.1
title: Rencontre 7.1 - Pare-feu et ports d'√©coute
sidebar_label: 7.1 - Pare-feu et ports d'√©coute
draft: false
hide_table_of_contents: false
---

Vous avez sans doute entendu dire qu'un pare-feu sert √† vous prot√©ger des attaques provenant du r√©seau. Mais comment √ßa marche au juste?


## Les ports d'√©coute

Tous les ordinateurs sur un r√©seau jouent √† la fois le r√¥le de client et de serveur. Dans une dynamique client-serveur, le client est la machine qui utilise un service alors que le serveur est celle qui rend le service au client. Le client s'attend normalement √† ce que le serveur doit disponible au moment o√π il souhaite passer sa requ√™te, donc le serveur doit √©couter en tout temps sur le r√©seau. 

Le serveur doit donc √™tre accessible sur le r√©seau. Les clients le contactent au moyen de son adresse IP. Le serveur ouvre un **port d'√©coute** correspondant au protocole de communication utilis√© par convention pour chaque service. Par exemple, un navigateur Web (appel√© aussi un client Web) passe ses requ√™tes HTTPS sur le port 443 du serveur, et donc le serveur Web a ouvert son port 443 pour recevoir les requ√™tes des clients.


### Identifier les ports ouverts

#### Netstat

Normalement, un syst√®me d'exploitation ouvre un port d'√©coute √† la demande d'un programme (ou service) qui s'ex√©cute en arri√®re-plan.

On peut utiliser la commande `netstat -a` sous Linux et Windows afin d'obtenir des informations sur les connexions r√©seau, les ports utilis√©s et les statistiques des interfaces **sur son ordinateur**.

```bash
C:\> netstat -a

Connexions actives

  Proto  Adresse locale         Adresse distante       √âtat
  TCP    0.0.0.0:135            MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:445            MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:902            MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:912            MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:2179           MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:2701           MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:3389           MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:5040           MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:5985           MABELLEMACHINE:0       LISTENING
  TCP    0.0.0.0:7680           MABELLEMACHINE:0       LISTENING
  ...    ...                    ...                    ...
```
#### Nmap

Contrairement √† `netstat`, `nmap` agit plut√¥t comme un outil de cartographie r√©seau. Bien qu‚Äôil existe certaines similarit√©s entre les deux outils, `nmap` est principalement utilis√© pour analyser le r√©seau et d√©couvrir les ports et services ouverts **d‚Äôautres machines sur le r√©seau**. Voici un exemple de commande `nmap` sous Linux :

```bash
nmap www.siteexemplaire.com

Starting Nmap 7.93 ( https://nmap.org ) at 2025-10-08 19:05
Nmap scan report for www.siteexemplaire.com (203.0.113.42)
Host is up (0.12s latency).

PORT     STATE         SERVICE
25/tcp   open          smtp
80/tcp   open          http
53/udp   open          domain

Nmap done: 1 IP address (1 host up) scanned in 3.21 seconds
```

### Quelques ports bien connus

Les ports TCP et UDP utilis√©s par les diff√©rents protocoles sont √©tablis par convention dans les documents des normes d'Internet (les RFC). Voici certains ports bien connus pour des protocoles fr√©quemment utilis√©s:

| Protocole | Port(s) | Document de norme (RFC, autre...) |
| :-- | :-- | :-- |
| HTTP | 80/tcp | [RFC 2616](https://tools.ietf.org/html/rfc2616) |
| HTTPS | 443/tcp | [RFC 2818](https://tools.ietf.org/html/rfc2818) |
| FTP | 21/tcp | [RFC 959](https://tools.ietf.org/html/rfc959) |
| SSH | 22/tcp | [RFC 4251](https://tools.ietf.org/html/rfc4251) |
| Telnet | 23/tcp | [RFC 854](https://tools.ietf.org/html/rfc854) |
| SMTP | 25/tcp | [RFC 5321](https://tools.ietf.org/html/rfc5321) |
| DNS | 53/tcp/udp | [RFC 1035](https://tools.ietf.org/html/rfc1035) |
| DHCP | 67/udp (serveur), 68/udp (client) | [RFC 2131](https://tools.ietf.org/html/rfc2131) |
| POP3 | 110/tcp | [RFC 1939](https://tools.ietf.org/html/rfc1939) |
| MS-RPC | 135/tcp/udp (epmap), 49152-65535/tcp/udp (dyn)  | [MS-RPCE](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-rpce/290c38b1-92fe-4229-91e6-4fc376610c15) |
| IMAP | 143/tcp | [RFC 3501](https://tools.ietf.org/html/rfc3501) |
| LDAP | 389/tcp | [RFC 4511](https://tools.ietf.org/html/rfc4511) |
| SMB | 445/tcp | [MS-SMB](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-smb/f210069c-7086-4dc2-885e-861d837df688) |
| LDAPS | 636/tcp | [RFC 4511](https://tools.ietf.org/html/rfc4511) |
| Microsoft SQL Server| 1433/tcp, 1434/udp | [MC-SQLR](https://learn.microsoft.com/en-us/openspecs/windows_protocols/mc-sqlr/1ea6e25f-bff9-4364-ba21-5dc449a601b7) |
| NFS | 2049/tcp | [RFC 3010](https://tools.ietf.org/html/rfc3010) |
| MySQL | 3306/tcp | (non sp√©cifi√© par une RFC) |
| Bureau √† distance (RDP) | 3389/tcp | [MS-RDPBCGR](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-rdpbcgr/5073f4ed-1e93-45e1-b039-6e30c385867c) |
| PostgreSQL | 5432/tcp | (non sp√©cifi√© par une RFC) |


## Vuln√©rabilit√©s

Un port ouvert n'est pas forc√©ment un probl√®me, bien au contraire: les ports d'√©coute sont un √©l√©ment essentiel au fonctionnement d'Internet. Tous les serveurs Web doivent obligatoirement √©couter sur le port 443 et les serveurs SSH doivent obligatoirement √©couter sur le port 22. Toutefois, plus les ports ouverts en √©coute sont nombreux, plus le serveur r√©pond √† une multitude de protocoles et plus les chances que l'un de ces protocoles (ou du logiciel qui l'impl√©mente) soit vuln√©rable. 

Par ailleurs, un port ouvert permet √† une machine distante d'envoyer une requ√™te au serveur, ce qui entra√Æne un traitement plus ou moins important, d√©pendant de la nature de la requ√™te. Par exemple, une requ√™te Web √† un serveur d√©clenche une s√©rie d'actions sur le serveur: interpr√©tation de la requ√™te, validation de la session ou du cookie, formulation d'une requ√™te √† la base de donn√©es, interpr√©tation du r√©sultat, production dynamique de code HTML, renvoi de la r√©ponse au client. Ce travail peut √™tre exploit√© √† des fins de d√©ni de service distribu√© (DDoS), car ces attaques visent justement √† surcharger les ressources computationnelles de l'ordinateur cible.


## Correctifs

Chaque port constitue un point d'entr√©e potentiel pour les attaques. On dit alors que la surface d'exposition est grande. Il est donc important de limiter les ports ouverts √† seulement ce qui est n√©cessaire pour que le service fasse son travail (√† l'instar du principe du plus bas privil√®ge pour les permissions). Il y a plusieurs mani√®res d'y parvenir.


### Fermer ou d√©sactiver le service

On peut limiter la surface d'exposition en d√©sactivant les services dont notre syst√®me n'a pas besoin. Par exemple, si notre machine sert strictement de serveur Web et rien d'autre, on devrait voir uniquement les ports TCP 443 (et peut-√™tre aussi 80) en √©coute. Si d'autres ports sont ouverts, il faut identifier le programme qui √©coute sur le port et y mettre fin.

:::tip Identifier le programme derri√®re un port ouvert
Autant sous Linux que sous Windows, la commande `netstat -ano` permet d'obtenir la liste des ports ouverts (en mode "LISTENING") ainsi que l'identifiant du processus en ex√©cution (PID). Vous pouvez ensuite retrouver le programme responsable dans le gestionnaire de t√¢ches de Windows ou encore la commande `ps -ef | grep <PID>` sous Linux. Vous pouvez ensuite tenter de d√©couvrir comment ces services sont d√©marr√©s (par exemple, `/etc/init.d` sous Linux, `services.msc` sous Windows...). 
:::

### Pare-feu local

Il n'est parfois pas possible ou souhaitable de d√©sactiver compl√®tement le service, car ce service a une utilit√©. Par exemple, il arrive que les administrateurs de syst√®me aient besoin du service SSH pour administrer le serveur √† distance. √áa ne veut pas dire qu'on doit exposer ce port √† tout Internet. Il se peut aussi qu'on souhaite emp√™cher √† un utilisateur non-administrateur d'ouvrir un port (√ßa ne prend normalement pas de droits d'administration, seulement la capacit√© √† lancer un programme qui ouvre un port). On utilise alors un pare-feu.

Le pare-feu est un logiciel dont l'objectif est de contr√¥ler les entr√©es et sorties sur le r√©seau en laissant passer le trafic l√©gitime et en bloquant le trafic ind√©sirable. Il y a deux grandes cat√©gories de pare-feux: le pare-feu local, qui tourne sur le serveur, et le pare-feu d'infrastructure, qui tourne sur d'autres √©quipements.

Linux Ubuntu et Windows poss√®dent tous deux un pare-feu local pr√™t √† l'emploi. Dans les deux cas, il faut disposer des privil√®ges d'administrations pour modifier sa configuration. Ce pare-feu op√®re sur la machine et n'a donc aucun effet sur les autres syst√®mes, mais permet de bloquer des ports en amont et en aval. Il peut aussi √™tre configur√© de sorte qu'un port ne puisse √™tre ouvert que par un programme sp√©cifique.


### Pare-feu d'infrastructure

Le pare-feu d'infrastructure est un dispositif de s√©curit√© d√©ploy√© sur un r√©seau. Ce n'est pas un logiciel install√© sur un serveur mais plut√¥t une machine √† part enti√®re en bordure de deux r√©seaux. Tout le trafic r√©seau passe par lui, qui se r√©serve le droit de laisser passer les paquets ou les d√©truire, un peu comme un poste de douane. Ainsi, m√™me si on est administrateur de notre machine et qu'on laisse passer le trafic au moyen du pare-feu local, celui-ci pourrait ne pas pouvoir franchir le pare-feu d'infrastructure en bordure.

Une telle solution est tr√®s souvent impl√©ment√©es dans les r√©seaux d'entreprises. Non seulement on dispose un pare-feu en bordure pour filtrer les requ√™tes provenant des utilisateurs externes, dans une zone isol√©e du r√©seau qu'on nomme la zone d√©militaris√©e (DMZ), mais m√™me dans le r√©seau interne on segmente le r√©seau en plusieurs sous-r√©seaux, chacun s√©par√©s par un pare-feu. Ainsi, par exemple, il n'y a que l'application qui peut se connecter au serveur de base de donn√©es.

Le diagramme suivant montre un exemple d'une telle architecture, qu'on appelle l'architecture 3-tiers.

![Pare-feu d'infrastructure](./r14-01-parefeu.png)

Les pare-feux d'infrastructure sont souvent des produits commerciaux professionnels. Les principaux pare-feux sur la march√© incluent:
- Cisco ASA
- Fortinet FortiGate
- Palo Alto Networks NGFW
- pfSense / NetGate

Plusieurs de ces pare-feux sont dits de "nouvelle g√©n√©ration" et offrent des fonctionnalit√©s d'analyse de trafic, de filtrage de paquets et peuvent m√™me procurer un service de VPN.

:::info Question quiz!
Est-ce qu'un pare-feu peut bloquer:
- L'acc√®s au site web https://www.criminels.net
- L'acc√®s √† http://info.cegepmontpetit.ca (pour forcer l'utilisation de https)?
- L'acc√®s √† la page https://www.supersupersuper.com/pageinterdite.html (sans bloquer le reste du site)?
:::


## Configuration du pare-feu

La configuration du pare-feu se fait normalement au moyen de r√®gles de filtrage de paquets. 

### Crit√®res
Les r√®gles sont bas√©es sur plusieurs crit√®res, notamment:
- L'adresse IP et le port de source
- L'adresse IP et le port de destination
- Le protocole utilis√© (TCP, UDP, ICMP)

D'autres crit√®res sont possiblement support√©s par le pare-feu. Par exemple, le pare-feu de Windows permet d'ajouter un programme sp√©cifique √† une r√®gle ainsi qu'un profil r√©seau (par exemple, un r√©seau priv√© vs. un r√©seau public). Aussi, certains pare-feux avanc√©s peuvent inspecter le contenu des paquets pour d√©tecter des menaces (pourvu que la communication ne soit pas chiffr√©e ou que le pare-feu puisse la d√©chiffrer).

### Types de r√®gles
Typiquement, on peut d√©finir deux types de r√®gles:
- Les r√®gles d'autorisation (allow) permettent le passage du trafic correspondant aux crit√®res sp√©cifi√©s
- Les r√®gles de blocage (deny) bloquent le trafic r√©seau correspondant aux crit√®res sp√©cifi√©s

### Direction
Le pare-feu est en mesure de contr√¥ler le trafic dans l'une ou l'autre des directions:
- Les r√®gles de trafic entrant contr√¥lent le trafic qui est initi√© par un client distant vers nous.
- Les r√®gles de trafic sortant contr√¥lent le trafic qui est initi√© par nous vers un serveur.

### Ordre des r√®gles
Dans certains pare-feux, l'ordre des r√®gles est important. Les r√®gles de filtrage sont g√©n√©ralement √©valu√©es dans un ordre s√©quentiel. Le pare-feu examine chaque paquet et applique la premi√®re r√®gle correspondante. Si aucune r√®gle ne correspond, une action par d√©faut (g√©n√©ralement le blocage) est appliqu√©e. Ce ne sont toutefois pas tous les pare-feux qui fonctionnent comme √ßa: celui de Windows, par exemple, ne tient pas compte de l'ordre des r√®gles.

:::caution D√©sactiver compl√®tement le pare-feu?
Il peut √™tre tentant de d√©sactiver compl√®tement le pare-feu pour "r√©gler" un probl√®me de connectivit√©. La d√©sactivation du pare-feu (ou la cr√©ation d'une r√®gle tr√®s permissive) est rarement une solution d√©finitive. Il peut √™tre acceptable de d√©sactiver le pare-feu temporairement, pour tester ou pour confirmer si le blocage provient du pare-feu, mais on doit le r√©activer le plus rapidement possible.
:::


## Pare-feux locaux

### Pare-feu de Windows

Sous Windows, on peut g√©rer le pare-feu par le panneau de configuration "Pare-feu Windows Defender". Vous pouvez g√©rer les r√®gles entrantes et sortantes en cliquant sur "param√®tres avanc√©s" ou en ouvrant la console `wf.msc`. Vous y trouverez un ensemble de r√®gles que vous pouvez modifier. Sachez toutefois que dans un environnement d'entreprise (comme au C√âGEP √âdouard-Montpetit), le pare-feu de Windows est g√©n√©ralement contr√¥l√© centralement par les administrateurs du domaine.

![Pare-feu Windows Defender](windowsfirewall.png)

### Pare-feu de Linux (Ubuntu)

Voici un site qui explique le fonctionnement du pare-feu par d√©faut de Linux Ubuntu:

https://documentation.ubuntu.com/server/how-to/security/firewalls/


## D√©mo: Capture de ports avec WireShark

Nous allons acc√©der au serveur http://perdus.com qui est plus simple parce qu'il fonctionne en HTTP simple:
1. ouvrez Chrome et tapez http://perdus.com mais sans appuyer sur Enter
2. ouvrez Firefox et tapez http://perdus.com mais sans appuyer sur Enter
3. ouvrez Wireshark et d√©marrez la capture sur l'interface ethernet
4. rapidement, allez appuyer sur Enter dans Chrome et Firefox
5. arr√™tez la capture Wireshark avec le bouton carr√© rouge
6. nous allons regarder les diff√©rentes requ√™tes HTTP qui ont √©t√© faites et en particulier les ports source / destination


## Exercices

### Exercice 1 : Fermeture de ports entrants

Dans cet exercice, nous allons fermer un port sp√©cifique pour bloquer le trafic entrant sur ta machine.

1. Ouvre la console du pare-feu Windows en lan√ßant la commande `wf.msc` depuis l'invite de commande ou le menu D√©marrer.
2. Cr√©e une r√®gle pour **bloquer le port 445** en entr√©e.  
üí° Le port 445 correspond au protocole SMB (partage de fichiers Windows).
3. Le professeur ex√©cutera un script pour tester l'ouverture de ce port sur tous les postes du local. V√©rifie que le port est bien ferm√©.

:::caution
Tu ne pourras plus acc√©der √† la plupart des sites pendant que la r√®gle sera active, y compris OneDrive. Sauvegarde tes donn√©es avant de continuer.
:::

---

### Exercice 2 : Fermeture de ports sortants

1. Ouvre √† nouveau la console du pare-feu Windows.
2. Cr√©e une r√®gle pour **bloquer le port 443** (HTTPS) en sortie.  
üí° Tu devrais toujours pouvoir naviguer sur des sites en HTTP, mais pas en HTTPS.
3. Pour tester un site en HTTP, utilise le site **[suivant](http://perdus.com/)**.
4. Une fois l‚Äôexercice termin√©, tu peux simplement **d√©sactiver ou supprimer la r√®gle** pour restaurer la connectivit√©.

---

### Exercice 3 : Interdire l'acc√®s √† un site Web

Dans cet exercice, nous voulons interdire l'acc√®s √† un site Web sp√©cifique, sans bloquer l'ensemble d'Internet.

1. En utilisant la commande `ping`, trouve l'adresse IP de l'h√¥te **[suivant](https://cat-bounce.com/)**.
2. Cr√©e une r√®gle dans ton pare-feu pour bloquer cette adresse IP en sortie. Il te faut une r√®gle **personnalis√©e**.  
üí° Essaie de naviguer dans l'interface du pare-feu pour cr√©er la r√®gle. L'interface est relativement intuitive, mais si tu bloques quelque part, tu peux demander l'aide de ton professeur.
3. Essaie d'acc√©der au **[site](https://cat-bounce.com/)** depuis ton navigateur.

:::caution
Si le site a d√©j√† √©t√© visit√© r√©cemment, il est possible qu‚Äôil soit stock√© dans le cache du navigateur et directement accessible, m√™me s‚Äôil est bloqu√©. Pour √©viter ce probl√®me, effectue un **hard refresh**, ce qui oblige le navigateur √† ret√©l√©charger toutes les donn√©es de la page, y compris les images et fichiers, au lieu d‚Äôutiliser les versions stock√©es en cache localement.  
Pour ce faire, appuie sur les touches `Ctrl + Shift + R`.
:::

:::info
Pour effectuer la commande `ping`, il faut s'assurer d'avoir **enlev√© l'en-t√™te http / https**.  
Exemples :  
- `ping https://info.cegepmontpetit.ca` ‚ùå  
- `ping info.cegepmontpetit.ca` ‚úÖ
:::

---

### Exercice 4 : Plusieurs adresses IP pour un m√™me nom DNS

Certains sites Web utilisent plusieurs serveurs pour r√©partir la charge ou assurer la redondance. Cela signifie qu‚Äôun m√™me nom DNS peut correspondre √† plusieurs adresses IP.

1. En utilisant la commande `ping`, trouve l'adresse IP de l'h√¥te **[suivant](https://theuselessweb.com/)**.
2. Cr√©e une r√®gle dans ton pare-feu pour bloquer cette adresse IP en sortie.
3. Essaie d'acc√©der au **[site](https://theuselessweb.com/)** depuis ton navigateur.  

**Que remarques-tu ?**

4. Utilise maintenant la commande `nslookup` pour le m√™me h√¥te.
5. Cr√©e une r√®gle dans ton pare-feu pour bloquer toutes les adresses IP de l'h√¥te en sortie.

---

### Exercice 5 : Plusieurs noms DNS pour une m√™me adresse IP

Certains serveurs Web peuvent h√©berger plusieurs sites avec la **m√™me adresse IP** (h√©bergement mutualis√©). Cela signifie qu'une m√™me adresse IP peut correspondre √† plusieurs noms DNS.

1. En utilisant la commande `nslookup`, trouve l'adresse IP de l'h√¥te **[Wiktionary](https://www.wiktionary.org/)**.  
üí° Le site Wiktionary est un dictionnaire libre et gratuit que tout le monde peut am√©liorer.
2. Cr√©e une r√®gle dans ton pare-feu pour bloquer **cette adresse IP** en sortie.
3. Essaie d'acc√©der √† **[Wikipedia](https://www.wikipedia.org/)** depuis ton navigateur.  

**Que remarques-tu ?**

4. Identifie maintenant d'autres noms DNS qui pointent vers la m√™me adresse IP en utilisant la commande `nslookup`.
5. Essaie d'acc√©der aux sites trouv√©s par la commande depuis ton navigateur. Enl√®ve des sections du lien jusqu'√† obtenir un r√©sultat.
